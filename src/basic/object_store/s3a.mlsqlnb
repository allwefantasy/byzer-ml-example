[{"kind":1,"language":"markdown","value":"# Azure S3","outputs":[]},{"kind":2,"language":"mlsql","value":"!plugin app add - \"byzer-objectstore-s3-3.3\";","outputs":[]},{"kind":2,"language":"mlsql","value":"-- define the s3a_ak and s3a_sk as session variables \n-- we use aes_decrypt to decrypt the encrypted access key/secret to avoid exposing the unencrypted key/secrect in the script\n\nSET s3a_ak=`select aes_decrypt(\"xxxxxxxxx\") AS s3a_ak;` where type=\"sql\" and scope=\"session\";\nSET s3a_sk=`select aes_decrypt(\"xxxxxxxxx\") AS s3a_ak;` where type=\"sql\" and scope=\"session\";\n\n-- Register S3A file system in byzer\nload FS.``\nWhere `fs.s3a.endpoint`=\"s3.ap-northeast-1.amazonaws.com\"\nand `fs.s3a.bucket.BUCKET_NAME.access.key`=\"${s3a_ak}\"\nand `fs.s3a.bucket.BUCKET_NAME.secret.key`=\"${s3a_sk}\"\nand `fs.s3a.impl`=\"org.apache.hadoop.fs.s3a.S3AFileSystem\"\nand `fs.AbstractFileSystem.s3a.impl`=\"org.apache.hadoop.fs.s3a.S3A\"\nas output;","outputs":[]},{"kind":2,"language":"mlsql","value":"-- load the data from S3\nload parquet.`s3a://BUCKET_NAME/poc/city_temperatures`  as city_temperatures;","outputs":[]}]